(function(e){"use strict";function o(e,o,n){var t,i,a,d=null,l=0;n||(n={});var s=function(){l=n.leading===!1?0:(new Date).getTime(),d=null,a=e.apply(t,i),d||(t=i=null)};return function(){var r=(new Date).getTime();l||n.leading!==!1||(l=r);var c=o-(r-l);return t=this,i=arguments,c<=0||c>o?(clearTimeout(d),d=null,l=r,a=e.apply(t,i),d||(t=i=null)):d||n.trailing===!1||(d=setTimeout(s,c)),a}}function n(){var e=this.isLabelMode,o=this.config.searchable,n=o?'<span class="dropdown-search">'+this.config.input+"</span>":"";return e?'<div class="dropdown-display-label"><div class="dropdown-chose-list">'+n+'</div></div><div class="dropdown-main">{{ul}}</div>':'<a href="javascript:;" class="dropdown-display"><span class="dropdown-chose-list"></span></a><div class="dropdown-main">'+n+"{{ul}}</div>"}function t(){var o=this,n=o.config,t=o.$el,i=t.find(".dropdown-maxItem-alert");clearTimeout(o.maxItemAlertTimer),0===i.length&&(i=e('<div class="dropdown-maxItem-alert">最多可选择'+n.limitCount+"个</div>")),t.append(i),o.maxItemAlertTimer=setTimeout(function(){t.find(".dropdown-maxItem-alert").remove()},1e3)}function i(e){var o=e||"";return o=o.replace(/<select[^>]*>/gi,"<ul>").replace("</select","</ul"),o=o.replace(/<\/optgroup>/gi,""),o=o.replace(/<optgroup[^>]*>/gi,function(e){var o=/label="(.[^"]*)"(\s|>)/.exec(e),n=/data\-group\-id="(.[^"]*)"(\s|>)/.exec(e);return'<li class="dropdown-group" data-group-id="'+(n[1]||"")+'">'+(o[1]||"")+"</li>"}),o=o.replace(/<option(.*?)<\/option>/gi,function(e){var o=/value="(.[^"]*)"(\s|>)/.exec(e),n=/>(.*)<\//.exec(e),t=e.indexOf("selected")>-1,i=e.indexOf("disabled")>-1;return"<li "+(i?" disabled":' tabindex="0"')+'  \n                                    data-value="'+(o[1]||"")+'" \n                                    class="dropdown-option '+(t?"dropdown-chose":"")+'">'+(n[1]||"")+"</li>"})}function a(o){var n={},t="",i=[],a=0;return!(!o||!o.length)&&(e.each(o,function(e,o){var t=o.groupId,d=o.disabled?" disabled":"",l=o.selected&&!d?" selected":"",s="<option"+d+l+' value="'+o.id+'">'+o.name+"</option>";l&&(i.push('<span class="dropdown-selected">'+o.name+'<i class="del" data-id="'+o.id+'"></i></span>'),a++),t?n[o.groupId]?n[o.groupId]+=s:n[o.groupId]=o.groupName+"&janking&"+s:n[e]=s}),e.each(n,function(e,o){var n=o.split("&janking&");if(2===n.length){var i=n[0],a=n[1];t+='<optgroup label="'+i+'" data-group-id="'+e+'">'+a+"</optgroup>"}else t+=o}),[t,i,a])}function d(o){function n(o,n){var t=e(n);this.id=t.prop("value"),this.name=t.text(),this.disabled=t.prop("disabled"),this.selected=t.prop("selected")}var t=o,i=[];return e.each(t.children(),function(o,t){var a={},d={},l=e(t);"OPTGROUP"===t.nodeName?(d.groupId=l.data("groupId"),d.groupName=l.attr("label"),e.each(l.children(),e.proxy(n,a)),e.extend(a,d)):e.each(l,e.proxy(n,a)),i.push(a)}),i}function l(o,n){this.$el=e(n),this.$select=this.$el.find("select"),this.placeholder=this.$select.attr("placeholder"),this.config=o,this.name=[],this.isSingleSelect=!this.$select.prop("multiple"),this.selectAmount=0,this.maxItemAlertTimer=null,this.isLabelMode="label"===this.config.multipleMode,this.init()}var s=function(){var e=navigator.userAgent.toLowerCase();if(e.indexOf("safari")!==-1)return!(e.indexOf("chrome")>-1)}(),r={readOnly:!1,limitCount:1/0,input:'<input type="text" maxLength="20" placeholder="搜索关键词或ID">',data:[],searchable:!0,searchNoData:'<li style="color:#ddd">查无数据，换个词儿试试 /(ㄒoㄒ)/~~</li>',choice:function(){}},c={up:38,down:40,enter:13},p={show:function(o){o.stopPropagation();var n=this;e(document).trigger("click.dropdown"),n.$el.toggleClass("active")},search:o(function(o){var n=this,t=n.config,d=n.$el,l=e(o.target),s=l.val(),r=n.config.data,c=[];o.keyCode>36&&o.keyCode<41||(e.each(r,function(e,o){(o.name.toLowerCase().indexOf(s)>-1||""+o.id==""+s)&&c.push(o)}),d.find("ul").html(i(a(c)[0])||t.searchNoData))},300),control:function(o){var n,t,i,a=o.keyCode,d=c,l=0;a!==d.down&&a!==d.up||(n=a===d.up?-1:1,i=this.$el.find("[tabindex]"),t=i.index(e(document.activeElement)),l=t===-1?n+1?-1:0:t,l+=n,l===i.length&&(l=0),i.eq(l).focus(),o.preventDefault())},multiChoose:function(o){var n=this,i=n.config,a=n.$select,d=e(o.target),l=d.data("value"),s=d.hasClass("dropdown-chose");if(s)d.removeClass("dropdown-chose"),n.selectAmount--;else{if(!(n.selectAmount<i.limitCount))return t.call(n),!1;d.addClass("dropdown-chose"),n.selectAmount++}n.name=[],e.each(i.data,function(e,o){""+o.id==""+l&&(o.selected=!s),o.selected&&n.name.push('<span class="dropdown-selected">'+o.name+'<i class="del" data-id="'+o.id+'"></i></span>')}),a.find('option[value="'+l+'"]').prop("selected",!s),n.$choseList.find(".dropdown-selected").remove(),n.$choseList.prepend(n.name.join("")),i.choice.call(n,o)},singleChoose:function(o){var n=this,t=n.config,i=n.$el,a=n.$select,d=e(o.target),l=d.data("value"),s=d.hasClass("dropdown-chose");return n.name=[],!d.hasClass("dropdown-chose")&&(i.removeClass("active").find("li").not(d).removeClass("dropdown-chose"),d.toggleClass("dropdown-chose"),e.each(t.data,function(e,o){o.selected=!1,""+o.id==""+l&&(o.selected=s?0:1,o.selected&&n.name.push('<span class="dropdown-selected">'+o.name+'<i class="del" data-id="'+o.id+'"></i></span>'))}),a.find('option[value="'+l+'"]').prop("selected",!0),n.name.push('<span class="placeholder">'+n.placeholder+"</span>"),void n.$choseList.html(n.name.join("")))},del:function(o){var n=this,t=e(o.target),i=t.data("id");return e.each(n.name,function(e,o){if(o.indexOf('data-id="'+i+'"')!==-1)return n.name.splice(e,1),!1}),e.each(n.config.data,function(e,o){if(o.id===i)return o.selected=!1,!1}),n.selectAmount--,n.$el.find('[data-value="'+i+'"]').removeClass("dropdown-chose"),n.$el.find('[value="'+i+'"]').prop("selected",!1).removeAttr("selected"),t.closest(".dropdown-selected").remove(),!1}};l.prototype={init:function(){var o=this,n=o.config,t=o.$el,i=s?"click.iui-dropdown":"focus.iui-dropdown";t.addClass(o.isSingleSelect?"dropdown-single":o.isLabelMode?"dropdown-multiple-label":"dropdown-multiple"),0===n.data.length&&(n.data=d(o.$select));var l=a(n.data);o.name=l[1],o.selectAmount=l[2],o.$select.html(l[0]),o.renderSelect(),t.on("click.iui-dropdown",function(e){e.stopPropagation()}),o.isLabelMode?(t.on("click.iui-dropdown",".dropdown-display-label",function(){t.find("input").focus()}),t.on("click.iui-dropdown",".del",e.proxy(p.del,o)),t.on("focus.iui-dropdown","input",e.proxy(p.show,o)),t.on("keydown.iui-dropdown","input",function(e){8===e.keyCode&&""===this.value&&o.name.length&&t.find(".del").eq(-1).trigger("click")})):t.on(i,".dropdown-display",e.proxy(p.show,o)),t.on("keyup.iui-dropdown","input",e.proxy(p.search,o)),t.on("keyup.iui-dropdown",function(n){var t=n.keyCode,i=c;t===i.enter&&e.proxy(o.isSingleSelect?p.singleChoose:p.multiChoose,o,n)()}),t.on("keydown.iui-dropdown",e.proxy(p.control,o)),t.on("click.iui-dropdown","[tabindex]",e.proxy(o.isSingleSelect?p.singleChoose:p.multiChoose,o))},renderSelect:function(){var o=this,t=o.$el,a=o.$select,d=n.call(o).replace("{{ul}}",i(a.prop("outerHTML")));t.append(d).find("ul").removeAttr("style class"),o.$choseList=t.find(".dropdown-chose-list"),o.isLabelMode||o.$choseList.html(e('<span class="placeholder"></span>').text(o.placeholder)),o.$choseList.prepend(o.name.join(""))}},e(document).on("click.dropdown",function(){e(".dropdown-single,.dropdown-multiple,.dropdown-multiple-label").removeClass("active")}),e.fn.dropdown=function(o){return this.each(function(n,t){e(t).data("iui-dropdown",new l(e.extend(!0,{},r,o),t))}),this}})(jQuery);